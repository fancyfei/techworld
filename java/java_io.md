# Java的IO流处理

I/O 即输入Input/ 输出Output，其实就是计算机调度把各个存储中（包括内存和外部存储）的数据写入写出的过程。

通过抽象的“流”的形式允许程序使用相同的方式来访问不同的输入/输出源，封装成各种“类”，都放在java.io这个包里面。

![io](./img/java_io_frame.png)

## 流的抽象

java中用“流（stream）”来抽象输入输出的功能，表示从起源（source）到接收的（sink）的有序数据。

从流的方向分类：

- 输入流，从数据源读取数据，由InputStream和Reader作为基类。
- 输出流，向目的地写入数据，由OutputStream和Writer作为基类。

从流的操作对象来分类：

- 字节流，以字节（8位字节）为主要操作对象，由InputStream和OutputStream作为基类。
- 字符流，以字符（16位的字符）为主要操作对象，由Reader和Writer作为基类。

从流的操作方式来分类：

- 节点流，就是直接面向特定的IO设备的原始流。
- 处理流，就是在已经存在的流对象之上的更高级操作，这一般IO对经典装饰者模式的应用。

## 常见的处理流

![java_io_class](img\java_io_class.png)

- 缓冲流：在读入或写出时，对数据进行缓存，以减少I/O的次数。
- 抽象的过滤流：在数据进行读或写时进行过滤。
- 转换流：按照一定的编码/解码标准将字节流转换为字符流，或进行反向转换。
- 对象流，处理Java对象的读写，也就是序列化和反序列化的操作。
- 特殊数据流： 按Java基本数据类型读、写。
- 文件流、数组流、字符串流：都是封装针对具体的对象的流。

## IO的使用

- Java IO大量使用了装饰者（Decorator）模式，如果自定义一个处理流的类，也应当如此。
- 针对各种源读写都有特定的类。一般以此为基础，加以组装，来适配特定业务。
- 注意字符与字节的转换，可能会需要合适的字符编码。
- 首先设计功能操作，再设计性能操作。
- n尽量使用已经包装好的公共IO组件，如Commons-IO包。

## IO技术分类

- BIO (同步阻塞 I/O)，服务器实现模式为一个连接一个线程，即客户端有连接请求时服务器端就需要启动一个线程进行处理。java.io包下面实现的就是BIO。
- NIO(同步非阻塞 I/O)，服务器实现模式为一个请求一个线程，即客户端发送的连接请求都会注册到多路复用器上，多路复用器轮询到连接有I/O请求时才启动一个线程进行处理。java.nio包下面实现的就是NIO。
- AIO (异步非阻塞 I/O)，服务器实现模式为一个有效请求一个线程，客户端的I/O请求都是由OS先完成了再通知服务器应用去启动线程进行处理。java.nio包下面新的一些API及实现是AIO。

