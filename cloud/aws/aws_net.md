#  AWS服务网络架构
AWS向客户所提供网络服务（Network As A Service）以及各种不同的服务须要的网络架构。
AWS所抽象过的网络组件，隐藏了很多现实中网络的细节。

较常见的架构，由VPC构建出AWS里面虚拟局域网，在同一个VPC下的划子网(subnet)。
子网通过互联网关（Internet Gateways）连通外网，如果子网中多EC2使用同一个互联网关，则可以通过NAT网关中转，访问规则记录在路由表（Routing Tables）。
子网之间可默认可访问，但是可以对ACL和Security Group进行访问控制。

## 常见的网络及访问控制
- 互联网访问，通过IGW互联网关（Internet Gateways）。
- VPC内网，默认可访问，权限由ACL和SG（Security Group）控制。
- REGION下不同VPC之间，借助VPC Peering来实现互联。
- 不同REGION的VPC之间，则需要公网的VPN来实现IPSec（安全协议）连接，需要网段不重。
- VPC和客户内网之间，同样要公网的VPN，另外为保证质量可用AWS的VPN，如需要无障碍打通需要专线。

## VPC提供的网络组件
- VPC

  VPC （Virtual Private Cloud ），虚拟私有云，是基础设施所运行在的一个私有网络空间。VPC有一段自已的地址空间（CIDR 范围），例如 10.0.0.0/16 。这将决定 VPC 内有多少可分配 IP 。相互之间是隔离的网络环境。

  每个用户都有一个默认的VPC，每个VPC下都有一个默认子网，VPC创建的时候会有一个默认主路由表。在VPC内部无需使用 Internet 网关、NAT 或防火墙代理。

- Subnet（子网）

  子网是VPC的一部分，具有自己的CIDR范围以及流量如何流动的规则（路由表），每个子网都有其自己的规则。能被外网访问的是“公有”子网，不能被外网访问的是“私有”子网。Subnet在默认下会关联到VPC的主路由表。将默认路由指向一个NAT网关，“私有”子网就可以通过NAT网关访问互联网。

- Route Table（路由表）

  路由表规定了一系列子网 IP 数据包如何传输到其他不同 IP 地址的规则。创建VPC时就会自动生成一个主路由表，默认情况下子网将与主路由表建立隐式关联。可以为 VPC 创建多个额外的自定义路由表，显式控制每个子网的出站数据流的路由方式。

- Internet Gateway（互联网关）

  互联网关是VPC 中的实例访问Internet的必经之地。在 VPC 路由表中路由目标设定为互联网关则可访问外网；互联网关将Internet流量进行NAT到有公有 IP 地址的实例。

  将 Internet 网关附加到 VPC，子网与公网的路由表（包含指向 Internet 网关的路由）相关联，该子网就是所谓的公有子网，配置安全组与访问控制允许流入和流出，则子网中的实例（有全局唯一 IP 地址）就可以被Internet 访问到了。

- NAT (网络地址转换) 网关

  使用 NAT 设备允许私有子网中的实例连接到 Internet 或其他 AWS 服务，只出不进。在创建 NAT 网关时需要指定在一个公有子网、该网关关联的弹性 IP 地址、更新私有子网关联的路由表（将Internet 绑定流量指向该 NAT 网关），然后通过“Internet网关”联通外网。NAT网关只能绑定一个弹性 IP 地址且不无解绑，删除才能解绑。

  AWS 提供了两种 NAT 设备：一种是 NAT 网关，一种是 NAT 实例。一般使用NAT 网关（是一个托管服务），当然实例也是一种EC2，可作其他更多用处。

- Identity and Access Management (IAM)

  AWS 身份控制服务，可帮助管理员安全地控制对 AWS 资源的访问。主要管理用户、用户组、角色、权限。

- Security Group（安全组）

  安全组充当实例的虚拟防火墙以控制入站和出站流量。安全组在实例级别运行，而不是子网级别，每个实例对应一个安全组。只配置允许规则，无拒绝规则，默认下不允许入站，允许全部出站，入站和出站流量指定单独规则。安全组是有状态，能入则能出，能出则能入。

- ACL（网络访问控制列表）

  是 VPC 的一个可选安全层，可用作防火墙来控制进出一个或多个子网的流量，规则与安全组相似。默认情况下允许所有出入站IP4/6的流量。无状态，出站、入站单独配置，且有允许、拒绝规则。

- Elastic IP（弹性 IP）

  EIP是静态公有 IPv4 地址，可与VPC 中的任何实例或网络接口相关联（可改），与网络接口关联可方便转移（它是网络接口的一个属性）。EIP不收费，未关联的EIP是要收费的，且最多有5个EIP。

- DNS（域名系统）

  它将名称解析到各自相应的 IP 地址，AWS提供对应实例的公有和私有 DNS 主机名。“.internal”是私有域名，“.amazonaws.com”是公有域名。如果是自定义域名，可以使用Route 53来管理。



