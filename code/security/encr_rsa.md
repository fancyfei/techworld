# å¸¸ç”¨åŠ å¯†æ–¹å¼-RSAéå¯¹ç§°åŠ å¯†ç®—æ³•

RSAåŠ å¯†ç®—æ³•æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ˜¯ç›®å‰æœ€å¸¸ç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œè¢«ISOæ¨èä¸ºå…¬é’¥æ•°æ®åŠ å¯†æ ‡å‡†ã€‚æ˜¯1977å¹´ç”±Ron Rivestï¼ŒAdi Shamirï¼ŒLeonard Adlemanåœ¨éº»çœç†å·¥å­¦é™¢å·¥ä½œæ—¶ä¸€èµ·æå‡ºçš„ã€‚

> éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå°±æ˜¯æŒ‡åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œå³ä½¿ç”¨åŠ å¯†å¯†é’¥è¿›è¡ŒåŠ å¯†ã€è§£å¯†å¯†é’¥è¿›è¡Œè§£å¯†ã€‚
>
> ä¹‹æ‰€ä»¥ä¹Ÿå«å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå› ä¸ºä½¿ç”¨æ—¶æŠŠå…¶ä¸­åŠ å¯†å¯†é’¥ï¼ˆå…¬é’¥ï¼‰å…¬å¼€ï¼Œè€Œè§£å¯†å¯†é’¥ï¼ˆç§é’¥ï¼‰ä¿å¯†ï¼ˆä¹Ÿå¯ä»¥ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ï¼‰ã€‚
>
> å¸¸è§çš„å…¬é’¥å¯†ç ç®—æ³•æœ‰ï¼šRSAã€ECCã€ElGamalã€Diffie-Hellmanã€ECDHã€ECDSA å’Œ EdDSAç­‰ç­‰ã€‚

å®ƒçš„ä½¿ç”¨åœºæ™¯éå¸¸å¤šï¼Œä¸»è¦æœ‰ä¸‰å¤§ç”¨é€”ï¼šåŠ å¯†ä¸è§£å¯†ã€ç­¾åä¸éªŒè¯ã€å¯†é’¥äº¤æ¢ã€‚æ¯”è¾ƒå¸¸è§åœ¨HTTPSã€SSHç­‰åè®®ä¸­éƒ½ä½¿ç”¨äº†RSAç®—æ³•æ¥åŠ å¯†é€šä¿¡è¿‡ç¨‹ä¸­çš„æ•°æ®ï¼ˆåå•†ä¼šè¯å¯†é’¥çš„è¿‡ç¨‹ï¼‰ï¼Œæ•°å­—è¯ä¹¦ä¹Ÿä½¿ç”¨RSAç®—æ³•ã€‚

RSA å¯ä»¥ä½¿ç”¨ä¸åŒé•¿åº¦çš„å¯†é’¥ï¼š1024ã€2048ã€3072ã€4096ã€8129ã€16384 ç”šè‡³æ›´å¤šã€‚ä¸è¿‡å°äº2048ä½çš„å¯†é’¥ç­‰äºç°åœ¨è¢«ç ´è§£çš„é£é™©ã€‚ä½†æ˜¯è¶Šé•¿çš„å¯†é’¥ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„è®¡ç®—æ—¶é—´ã€‚

RSAåŠ å¯†æ˜æ–‡æœ€å¤§é•¿åº¦117å­—èŠ‚ï¼Œè§£å¯†è¦æ±‚å¯†æ–‡æœ€å¤§é•¿åº¦ä¸º128å­—èŠ‚ï¼Œæ‰€ä»¥åœ¨åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ä¸­éœ€è¦åˆ†å—è¿›è¡Œã€‚

### ç®—æ³•çš„åŸç†

éå¯¹ç§°åŠ å¯†ç®—æ³•çš„æ ¸å¿ƒè®¾æƒ³å°±æ˜¯ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒè§„åˆ™ï¼Œä½†æ˜¯å¯†æ–‡ä¸æ˜æ–‡é—´å¯ä»¥é€šè¿‡å„è‡ªçš„è®¡ç®—é€»è¾‘è½¬æ¢ã€‚åœ¨æ•°è®ºä¸­ï¼Œç”¨æ¬§æ‹‰å‡½æ•°å¯¹ä¸¤ä¸ªäº’è´¨æ•°è¿›è¡Œè®¡ç®—å¾—åˆ°å‡ ä¸ªæ•°å­—å³å¯è¿›è¡Œå¯†æ–‡æ˜æ–‡ä¹‹é—´çš„è½¬æ¢ã€‚

> - è´¨æ•°ï¼šè‹¥ä¸€ä¸ªæ•° ğ‘(ğ‘>1) æ»¡è¶³å®ƒçš„å› å­åªæœ‰ 1 å’Œå®ƒæœ¬èº«ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™ä¸ªæ•°ä¸ºç´ æ•°ï¼ˆè´¨æ•°ï¼‰ã€‚
>
> - äº’è´¨ï¼šå¦‚æœä¸¤ä¸ªæ­£æ•´æ•°ï¼Œé™¤äº†1ä»¥å¤–ï¼Œæ²¡æœ‰å…¶ä»–å…¬å› å­ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ•°æ˜¯äº’è´¨å…³ç³»ã€‚
> - æ¬§æ‹‰å‡½æ•°ï¼šä»»æ„ç»™å®šæ­£æ•´æ•°nï¼Œè¯·é—®åœ¨å°äºç­‰äºnçš„æ­£æ•´æ•°ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªä¸næ„æˆäº’è´¨å…³ç³»ï¼Œè¿™ä¸ªè®¡ç®—å…¬å¼è®¡ç®—æ¬§æ‹‰å‡½æ•°ã€‚

åŠ å¯†å…¬å¼ä¸ºï¼šm^e â‰¡ c (mod N)ã€‚

è§£å¯†å…¬å¼ä¸ºï¼šc^d â‰¡ m (mod N)ã€‚

> - æ¨¡è¿ç®—ï¼šmodï¼ˆ%ï¼‰ï¼Œæ•´æ•°è¢«ä¸€ä¸ªæ­£æ•´æ•°é™¤æ—¶çš„ä½™æ•°ã€‚ä¸¤ä¸ªæ•´æ•°è¢«åŒä¸€ä¸ªæ­£æ•´æ•°é™¤æ—¶çš„ä½™æ•°ç›¸åŒåˆ™ç§°ä¸ºåŒä½™æ•°ã€‚

å…¶ä¸­å…¬é’¥å°±æ˜¯ï¼ˆNï¼Œeï¼‰ï¼Œè€Œç§é’¥å°±æ˜¯ï¼ˆNï¼Œdï¼‰ï¼Œmä¸ºæ˜æ–‡ï¼Œcä¸ºå¯†æ–‡ã€‚

å…³äºnï¼Œeï¼Œdè¿™å‡ ä¸ªæ•°å­—è®¡ç®—è®¡ç®—è¿‡ç¨‹ï¼š

ä¸¤ä¸ªäº’è´¨æ•°P1ã€P2ï¼Œè®¡ç®—å‡ºä¸¤äº’è´¨æ•°çš„ä¹˜ç§¯Nï¼Œç”¨æ¬§æ‹‰å‡½æ•°è®¡ç®—å‡ºÏ†(N)ï¼Œå†1åˆ°Ï†(N)ä¹‹é—´éšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°ä¸”ä¸Ï†(N)äº’è´¨çš„eï¼Œå†è®¡ç®—eå¯¹äºÏ†(n)çš„æ¨¡åå…ƒç´ dï¼Œè¿™éœ€è¦ä½¿ç”¨"æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•"æ¥æ±‚è§£dã€‚

> è¿™ä¸ªè¾ƒå¤§çš„æ•°Nå°±æ˜¯RSAç®—æ³•çš„å¯é æ€§çš„å…³é”®ï¼Œå› ä¸ºç”±å®ƒæ¨å¯¼å‡ºdæå…¶å›°éš¾ã€‚
>
> è¿™ä¸€ç³»åˆ—è¯æ˜è¿‡ç¨‹ç”¨åˆ°çš„æ•°å­¦çŸ¥è¯†æœ‰ï¼šæ±‚æ¨¡è¿ç®—ã€æœ€å¤§å…¬çº¦æ•°ã€æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•ã€ä¸­å›½ä½™æ•°å®šç†ã€æ¬§æ‹‰å‡½æ•°ã€è´¹é©¬å°å®šç†ç­‰ç­‰ã€‚

### ç®—æ³•ä¸¾ä¾‹

Aå’ŒBè¦ç›¸äº’é€šä¿¡ï¼š

1. Aéšæœºå–å¤§è´¨æ•°P1=53ï¼ŒP2=59ï¼Œé‚£N=53*59=3127ï¼ŒÏ†(N)=3016
2. å–ä¸€ä¸ªe=3ï¼Œè®¡ç®—å‡ºd=2011ã€‚
3. åªå°†N=3127ï¼Œe=3 ä½œä¸ºå…¬é’¥ä¼ ç»™Bï¼ˆå…¬é’¥å…¬å¼€ï¼‰
4. å‡è®¾Béœ€è¦åŠ å¯†çš„æ˜æ–‡m=89ï¼Œc = 89^3 mod 3127=1394ï¼Œäºæ˜¯Bä¼ å›c=1394ã€‚ ï¼ˆå…¬é’¥åŠ å¯†è¿‡ç¨‹ï¼‰
5. Aä½¿ç”¨c^d mod N = 1394^2011 mod 3127ï¼Œå°±èƒ½å¾—åˆ°æ˜æ–‡m=89ã€‚ ï¼ˆç§é’¥è§£å¯†è¿‡ç¨‹ï¼‰

### å¯†é’¥çš„æ ¼å¼

å¯†é’¥çš„ç”Ÿæˆè¿‡ç¨‹ä½¿ç”¨åˆ°äº†6ä¸ªæ•°å­—ï¼š

- ä¸¤ä¸ªäº’è´¨æ•°ï¼Œ**P1**ã€**P2**ã€‚è¿™ä¸¤ä¸ªè´¨æ•°è¶Šå¤§ï¼Œå°±è¶Šéš¾ç ´è§£ã€‚
- ä¸¤ä¸ªäº’è´¨æ•°çš„ä¹˜ç§¯**N**ï¼Œå®ƒçš„é•¿åº¦å°±æ˜¯å¯†é’¥é•¿åº¦ã€‚RSAå¯†é’¥ä¸€èˆ¬æ˜¯1024ä½ï¼Œé‡è¦åœºåˆåˆ™ä¸º2048ä½ã€‚
- Nçš„æ¬§æ‹‰å‡½æ•°è®¡ç®—ç»“æœ**Ï†(N)**ã€‚
- åœ¨1åˆ°Ï†(N)ä¹‹é—´ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°**e**ã€‚RSAå¸¸å¸¸é€‰æ‹©65537ã€‚
- è®¡ç®—eå¯¹äºÏ†(n)çš„æ¨¡åå…ƒç´ **d**ã€‚

å°†Nå’Œeå°è£…æˆå…¬é’¥ï¼Œå¯¹å¤–å…¬å¼€ï¼ŒNå’Œdå°è£…æˆç§é’¥ã€‚å…¬é’¥å’Œç§é’¥çš„æ•°æ®éƒ½é‡‡ç”¨ASN.1è¯­æ³•å®šä¹‰ï¼ŒåŒæ—¶åŠ äº†å…¶ä»–çš„ä¿¡æ¯ã€‚å¯¹ASN.1å®šä¹‰çš„äºŒè¿›åˆ¶æ•°æ®ç»“æ„ï¼Œè¾“å‡ºå°±æ˜¯ DER æ ¼å¼ã€‚

> - ASN.1æ˜¯ä¸€å¥—æ ‡å‡†ï¼Œæ˜¯æè¿°æ•°æ®çš„è¡¨ç¤ºã€ç¼–ç ã€ä¼ è¾“ã€è§£ç çš„çµæ´»çš„è®°æ³•ã€‚å®ƒæä¾›äº†ä¸€å¥—æ­£å¼ã€æ— æ­§ä¹‰å’Œç²¾ç¡®çš„è§„åˆ™ä»¥æè¿°ç‹¬ç«‹äºç‰¹å®šè®¡ç®—æœºç¡¬ä»¶çš„å¯¹è±¡ç»“æ„ã€‚
>
> - DERï¼ŒDistinguished Encoding Rulesï¼Œå¯åˆ†è¾©ç¼–ç è§„åˆ™ï¼Œå†…å®¹æ˜¯äºŒè¿›åˆ¶ä¸²ã€‚æ–‡ä»¶åç¼€é€šå¸¸ä¸º â€œ.derâ€ã€‚

å…¬é’¥è¯­æ³•ï¼š

```
RSAPublicKey ::= SEQUENCE {
    modulus           INTEGER,  -- n
    publicExponent    INTEGER   -- e
}
```

ç§é’¥è¯­æ³•ï¼š

```
RSAPrivateKey ::= SEQUENCE {
  version           Version,
  modulus           INTEGER,  -- n
  publicExponent    INTEGER,  -- e
  privateExponent   INTEGER,  -- d
  prime1            INTEGER,  -- p
  prime2            INTEGER,  -- q
  exponent1         INTEGER,  -- d mod (p-1)
  exponent2         INTEGER,  -- d mod (q-1)
  coefficient       INTEGER,  -- (inverse of q) mod p
  otherPrimeInfos   OtherPrimeInfos OPTIONAL
}
```

ä¸€èˆ¬è€Œè¨€ï¼Œå¯†é’¥éƒ½æ˜¯é€šè¿‡ PEM çš„æ ¼å¼è¿›è¡Œå­˜å‚¨çš„ï¼Œå®ƒæ˜¯å¯¹DERçš„Base64çš„ç¼–ç å½¢å¼ï¼Œæ˜æ–‡æ ¼å¼ã€‚

> - PEMï¼ŒPrivacy-Enhanced Mailï¼Œéšç§å¢å¼ºé‚®ä»¶ã€‚PEMæ ¼å¼æ–‡ä»¶åç¼€é€šå¸¸ä¸º".pem"ã€â€œ.cerâ€ã€â€œ.crtâ€ã€â€œ.keyâ€ã€‚

åœ¨ASN.1è¯­æ³•åŸºç¡€ä¸Šï¼ŒRSAåˆ¶å®šäº†ä¸€ç»„å…¬é’¥å¯†ç å­¦æ ‡å‡†PKCSï¼ŒPKCS #1 æ ‡å‡†æ˜¯ä¸“é—¨ä¸º RSA å¯†é’¥è¿›è¡Œå®šä¹‰çš„ã€‚

> PKCSï¼Œï¼ˆPublic-Key Cryptography Standardsï¼Œå…¬é’¥åŠ å¯†æ ‡å‡†ï¼‰ï¼Œæ˜¯ä¸€ç³»åˆ—å…¬é’¥å¯†ç å­¦æ ‡å‡†ï¼ŒåŒ…æ‹¬äº†è®¸å¤šæ ‡å‡†ï¼Œæ¶µç›–äº†å¯†é’¥ç®¡ç†ã€æ•°å­—ç­¾åã€åŠ å¯†ç®—æ³•ç­‰å¤šä¸ªæ–¹é¢ã€‚

PKCS#1 å¯¹åº”çš„ PEM æ ¼å¼å¦‚ä¸‹ï¼š

```
-----BEGIN RSA PRIVATE KEY-----
BASE64 ENCODED DATA
-----END RSA PRIVATE KEY-----
```

æ³¨ï¼šPKCSå·²ç»å…¬å¸ƒäº†15ä¸ªæ ‡å‡†ï¼Œå…¶ç¼–å·åˆ†åˆ«ä¸ºPCKS#1~15ã€‚

> PEMæ ¼å¼çš„å¯†é’¥æ–‡ä»¶çš„åç¼€ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯. pemï¼Œä¸‹é¢å‡ ä¸ªä¹Ÿæœ‰ä¸åŒï¼š
>
> PKCS#8æ–‡ä»¶çš„åç¼€ä¸º .key
> PKCS#12æ–‡ä»¶çš„åç¼€ä¸º .p12, pfx
> X.509æ–‡ä»¶åç¼€ä¸º.cer, .crtï¼ˆX.509 æ˜¯å¯†ç å­¦é‡Œå…¬é’¥è¯ä¹¦çš„æ ¼å¼æ ‡å‡†ï¼‰

### OpenSSLç”ŸæˆRSAå¯†é’¥

1ï¼Œç”Ÿæˆä¸€ä¸ªRSAå¯†é’¥

```csharp
openssl genrsa -out private_pkcs1.pem 2048
```

2ï¼Œä»ç”Ÿæˆçš„RSAå¯†é’¥ä¸­æå–RSAå…¬é’¥

```
openssl rsa -in private_pkcs1.pem -out public_pkcs1.pem -pubout -RSAPublicKey_out
```
