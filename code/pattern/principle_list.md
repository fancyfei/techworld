# 设计模式的七大设计原则

根据《设计原则》及后来的总结，软件开发领域常见有 7 种设计原则，它们分别为开闭原则、里氏替换原则、依赖倒置原则、单一职责原则、接口隔离原则、迪米特法则和合成复用原则。

它们是软件设计模式必须尽量遵循的原则，是设计模式的基础。但是在实际中需要综合考虑人力、时间、成本、质量，在适当的场景遵循设计原则。

软件设计追求的目标，可扩展性、灵活性、可插入性，所有的原则都为了实现这些目标。

## 单一职责原则

单一职责原则SRP(Single Responsibility Principle)，类的功能要单一，仅有一个引起其变化的原因，提高高内聚来减少引起变化的原因。否则需要将类按不同功能职责拆分到不同的类中。

核心就是控制类的粒度大小、将对象解耦、提高其内聚性。

这个原则可以运用在方法、类、模块、微服务等维度。

遵守单一职责的好处如下：

- 降低类的复杂度。一个类只干一件事。
- 提高类的可读性。简单了就利于可读。
- 提高系统的可维护性。简单、易读，就容易维护。
- 降低变更引起的风险。修改影响的范围有限。

## 开闭原则

开放封闭原则OCP(Open－Close Principle)，一个软件实体应当对扩展开放，对修改关闭。当有新的功能需求加入时，软件实体应尽量在不修改原有代码的情况下进行扩展。

做到开闭原则，抽象是关键，封装可变性。定义一个相对稳定的抽象层，而将相同的可变因素封装在相同的具体实现类中，可以通过扩展满足变化的需求。

封装可变性的需要注意：

- 继承可以对可变部分进行封装，可收集各处的变化。
- 不同的可变部分不可以混合。

开闭原则是设计的终极目标，让软件拥有一定的适应性和灵活性的同时具备稳定性和延续性。

主要优点：

- 对原有测试用例无需修改。只需要测试变化的部分。
- 提高代码的复用性。粒度越小，更利于被复用。
- 提高软件的可维护性。稳定的上层，可扩展的实现层，易于维护。

## 里式替换原则

里式替换原则LSP(the Liskov Substitution Principle)，所有引用基类（父类）的地方必须能透明地使用其子类的对象，任何时候都可以用子类型替换掉父类型。

这个原则依赖面向对象的继承特性和多态特性。

实现的方法是：

- 子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法。
- 子类可以增加自己的方法。
- 子类的方法重载父类的方法时，前置条件要更宽松。
- 子类的方法实现父类的抽象方法时，后置条件要更严格。

主要作用：

- 解决继承中重写了父类带来的可复用性变差的问题。

- 保证扩展不引入新错误。

## 依赖倒置原则

依赖倒置原则DIP(the Dependency Inversion Principle)，抽象不应该依赖于细节，细节应当依赖于抽象；高层模块不应该依赖低层模块，两者都应该依赖其抽象。换言之，要针对接口编程，而不是针对实现编程。

需要遵循的要点是：

- 每个类尽量提供接口或抽象类。
- 使用的时候的变量类型尽量是接口或抽象类。
- 不要从具体类派生。
- 继承时遵循里氏替换原则。

主要的作用：

- 降低类间的耦合。
- 提高系统的稳定性。依赖放在了稳定的抽象层。
- 减少并行开发引起的风险。
- 提高代码的可读性和可维护性。

## 接口分离原则

接口分离原则ISP(the Interface Segregation Principle)，使用多个专门的接口，而不使用单一的总接口，即客户端不应该依赖那些它不需要的接口。

与单一职责类似，强调高内聚性，低耦合性。但是关注点在接口上，而单一职责关注类的具体职责的实现上。

实现方法：

- 小接口，尽量只做一个业务逻辑，只服务一个模块。
- 为依赖方定制，不多不少。
- 前提是高内聚，才能最少的方法完成业务。

主要的作用：

- 提高系统的灵活性和可维护性。可防止修改扩散。
- 高内聚，降低了系统的耦合性。依赖度适当。
- 合理的小接口，保证系统的稳定性。过大则不灵活，过小则复杂。
- 能体现面向对象设计，强调对象的封装继承。
- 减少代码冗余。不用实现不需要的接口。

## 迪米特法则

迪米特法则LOD/LKP(Law of Demeter 又名Least Knowledge Principle)，一个软件实体应当尽可能少地与其他实体发生相互作用。降低类之间的耦合，提高模块的相对独立性。

实现方法：

- 为高内聚低耦合的功能创建类。
- 不过多暴露类成员的访问。
- 不暴露类的属性成员，而应该提供相应的访问器（set 和 get 方法）。
- 序列化（Serializable）的对象，最好不要修改内部结构。

主要优点：

- 降低了类之间的耦合度。依赖者操作简单，服务方只暴露应该暴露的方法。
- 提高了类的可复用率和系统的扩展性。相互之间较高的独立性。

## 合成复用原则

合成复用原则CRP(Composite Reuse Principle)，要尽量使用合成和聚合，尽量不要使用继承。

合成复用是将已有的对象作为新对象的成员对象，新对象可以调用已有对象的功能，从而达到复用。

继承存在的问题：

- 继承复用破坏包装。子类知道所有父类细节。如果要使用继承关系，则必须严格遵循里氏替换原则。

- 子类与父类的耦合度高。父类变化总是引起子类变化，不易维护和扩展。
- 继承是静态的，在编译时确定子类继承了父类的方法。缺失了灵活性。

选择合成的方式复用的优点：

- 维持了类的封装性。相互不需要看到各对象的内部细节。
- 降低各类耦合度。合成的对象之间依赖较少。
- 提高复用的灵活性。在运行时动态的进行复用。

